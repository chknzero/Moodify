<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moodify</title>
    
    <link rel="icon" type="image/png" href="resources/emoticon.png">
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navigation">
        <a href="index.html" title="Refresh Page">Home</a>
        <a href="list.html" title="Entry List">View Entries</a>
        <a href="stats.html" title="Mood Overview & Statistics">View Stats</a> <!-- link to graph page -->
    </nav>

    <!-- Main Mood Input Section -->
    
    <main>
    <div class="backdrop"></div>
        <h1 id="h-index" title="You good?">How are you feeling today?</h1>
        <div id="BtnContainer">
            <button class="emoji-btn great" data-feeling="Great" aria-label="Great mood"></button>
            <button class="emoji-btn good" data-feeling="Good" aria-label="Good mood"></button>
            <button class="emoji-btn meh" data-feeling="Meh" aria-label="Meh mood"></button>
            <button class="emoji-btn bad" data-feeling="Bad" aria-label="Bad mood"></button>
            <button class="emoji-btn awful" data-feeling="Awful" aria-label="Awful mood"></button>
        </div>
    </main>
    

    <!-- Popup Notes Section -->
    <div id="popup" class="popup">
        <div class="popup-content">
            <h3 id="popup-title"></h3>
            <textarea id="notes" placeholder="Tell me about your day..."></textarea>
            <div class="popup-buttons">
                <button id="saveBtn">Save</button>
                <button id="closeBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        /* ========== SELECT ELEMENTS ========== */
        const emojiBtns = document.querySelectorAll('.emoji-btn'); // all emoji buttons
        const popup = document.getElementById('popup'); // popup overlay
        const closeBtn = document.getElementById('closeBtn'); // close button
        const saveBtn = document.getElementById('saveBtn'); // save button
        const noteInput = document.getElementById('notes'); // textarea input
        const popupTitle = document.getElementById('popup-title'); // popup title

        /* ========== SHOW POPUP WHEN EMOJI CLICKED ========== */
        emojiBtns.forEach(button => {
            button.addEventListener('click', () => {
                const feeling = button.dataset.feeling || "Unknown Mood"; // get mood
                const f = feeling.toLowerCase();

                popup.classList.add('show'); // display popup
                noteInput.focus(); // auto-focus textarea
                popup.setAttribute('mood-selected', feeling); // store selected mood

                // Set popup title with friendly message
                const extraMessage = { great: 'Nice!', good: 'Nice!', bad: 'Sorry to hear that.', awful: 'sorry to hear that.' }[f] || '';
                popupTitle.textContent = `You are feeling ${feeling}${extraMessage ? ', ' + extraMessage : ''}`;
            });
        });

        /* ========== CLOSE POPUP ========== */
        closeBtn.addEventListener('click', () => {
            popup.classList.remove('show'); // hide popup
            noteInput.value = ''; // clear textarea
        });

        /* ========== SAVE MOOD AND NOTES ========== */
        saveBtn.addEventListener('click', () => {
            const mood = popup.getAttribute('mood-selected'); // get selected mood
            const notes = noteInput.value.trim(); // get notes

            if (!notes) { // prevent empty note
                alert('Write something first, ya goofball!');
                return;
            }

            const today = new Date().toISOString().split('T')[0]; // standard date format YYYY-MM-DD
            let moodRecords = JSON.parse(localStorage.getItem('moodRecords')) || []; // get existing records

            // check if entry exists today
            if (moodRecords.some(entry => entry.date === today)) {
                alert('You only get one entry per day.');
                popup.classList.remove('show');
                noteInput.value = '';
                return;
            }

            // add new record
            moodRecords.push({ date: today, mood, notes });

            localStorage.setItem('moodRecords', JSON.stringify(moodRecords)); // save to localStorage
            alert(`You are feeling ${mood} today!`);

            popup.classList.remove('show'); // hide popup
            noteInput.value = ''; // clear textarea
        });
    </script>
</body>
</html>
